[package]
name = "zenavif"
version = "0.1.0"
edition = "2024"
rust-version = "1.93"
license = "AGPL-3.0-or-later"
description = "Pure Rust AVIF image codec powered by rav1d and ravif"
categories = ["multimedia::images"]
keywords = ["avif", "decoder", "encoder", "av1", "image"]
repository = "https://github.com/imazen/zenavif"

[dependencies]
# rav1d: C FFI-based decoder for asm feature (fastest)
rav1d = { version = "1.1.0", default-features = false, features = ["bitdepth_8", "bitdepth_16"], optional = true }
# rav1d-safe: 100% safe managed API decoder (default, no c-ffi feature!)
# NOTE: Using default-features = false ensures c-ffi is NOT enabled
rav1d-safe = { path = "../rav1d-safe", default-features = false, features = ["bitdepth_8", "bitdepth_16"], optional = true }
archmage = { version = "0.5.0", features = ["macros", "safe_unaligned_simd"] }
magetypes = "0.5.0"
safe_unaligned_simd = "0.2.4"
zenavif-parse = "0.2.0"
yuv = "0.8.10"
imgref = "1.12.0"
rgb = { version = "0.8.52", default-features = false, features = ["as-bytes"] }
enough = "0.3.1"
thiserror = { version = "2.0", default-features = false }
whereat = "0.1.3"
log = "0.4"
ravif = { version = "0.13", default-features = false, optional = true }
zencodec-types = { path = "../zencodec-types", optional = true }

[dev-dependencies]
env_logger = { version = "0.11", default-features = false }
png = "0.18.0"
image = "0.25"
criterion = { version = "0.5", features = ["html_reports"] }

[[bench]]
name = "decode_benchmark"
harness = false

[[bench]]
name = "yuv_conversion_benchmark"
harness = false

[[bench]]
name = "yuv_crate_comparison"
harness = false

[features]
default = ["managed"]
# Use hand-written assembly (fastest, uses C FFI)
asm = ["dep:rav1d", "rav1d/asm"]
# Use 100% safe managed API (default - no unsafe code!)
managed = ["dep:rav1d-safe"]
# AVIF encoding via ravif (pure Rust by default)
encode = ["dep:ravif"]
# Encoding with hand-written assembly (fastest)
encode-asm = ["encode", "ravif/asm"]
# Encoding with multi-threading
encode-threading = ["encode", "ravif/threading"]
# zencodec-types trait implementations
zencodec = ["dep:zencodec-types"]

